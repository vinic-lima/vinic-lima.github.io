{"title":"Multiple estimation with custom statistics II","markdown":{"yaml":{"title":"Multiple estimation with custom statistics II","author":"Vinicius Lima","format":"html","editor":"visual","project-dir":"C:/Dropbox/academic/website/vinic-lima.github.io/posts"},"headingText":"The Problem","containsRefs":false,"markdown":"\n\nIn this post, I tackle the same problem of the [previous post](001_multiple_estim_custom_stats.html), but now I use more direct approach with `fixest`'s `etable` instead of `modelsummary`.\n\n\nRecall the dataset: there are two outcomes, `y1` and `y2`, and two treatment variables, `T1` and `T2`:\n\n```{r, echo=T, warning=FALSE, message=FALSE}\ndf_data <- readRDS('001_files/001_data.rds')\n\nhead(df_data)\n\nsummary(df_data)\n\n```\n\nI want to estimate the effect of each treatment on each outcome, running 4 regressions.\n\nAdditionally, I want to report the mean outcome among control units for each case. This is tricky because the estimation sample varies by treatment.\n\nWe'll solve this using the packages *fixest* and *dplyr*.\n\n## Solution\n\nUse `feols` to run the four regressions and store the results.\n\n```{r, warning=FALSE, message=FALSE}\nlibrary(dplyr)\nlibrary(fixest)\n\nmy_estimation <- feols(data = df_data, fml = c(y1,y2) ~ sw(T1, T2))\n```\n\nThe logic behind the approach is to retrieve the model's design matrix and then find the dependent variable values associated with the control observations. Let's first check how it works with a single model.\n\n```{r}\n\n# The object 'my_estimation' is a list; we must retrieve some of the elements to  work with `model.matrix`\nmy_estimation_1 <- my_estimation[lhs = 1, rhs = 1][[1]]\n\n# No, we get the treatment and dependent variables from the design matrix\nt <- model.matrix(my_estimation_1, subset = 'T', type = 'rhs') \ny <- model.matrix(my_estimation_1, type = 'lhs')\n\n# Find which rows contain the control units\ni <- which(t[,1] == 0)\n\n# Compute the mean of the dependent variable for the control units\nprint(mean(y[i]))\n```\n\n**Remark**: I used the argument \"subset\" to define `t`, but not with `y`. This is because the option \"rhs\" produces a matrix with all regressors. By using `subset = \"T\"` I tell the function that I want to keep in `t` only columns whose names match \"T\". In my case, this is sufficient to get only the treatment variable. Be cautious to ensure that you retrieve the correct variable.\n\nNow, I use the `fitstat_register` function from `fixest` to apply these steps to all regressions and display the computed statistic in the regression table.\n\nWe must supply three arguments for this function:\n\n```{r}\n\nfitstat_register(\n  type = \"meandepvar\", \n  fun = function(x) {\n    \n    t <- model.matrix(x, subset = 'T', type = 'rhs') \n    y <- model.matrix(x, type = 'lhs')\n    i <- which(t[,1] == 0)\n    return(mean(y[i]))\n    \n    },\n  alias = \"Mean of Dep. Variable\"\n  )\n\n```\n\nThe argument *type* establishes a name for the statistic, which you will need to refer to when calling it within the table.\n\nThen, we must supply the function that effectively computes the statistic using the objects available from the estimation output.\n\nFinally, the argument *alias* is the text displayed in the regression table.\n\nI now use `etable` to report the regression output, including the desired statistics with the \"fitstat\" argument. I include our custom \"meandepvar\" and the number of observations \"n\".\n\n```{r}\netable(my_estimation,\n       fitstat = ~ meandepvar + n)\n```\n\nThat's it.\n","srcMarkdownNoYaml":"\n\nIn this post, I tackle the same problem of the [previous post](001_multiple_estim_custom_stats.html), but now I use more direct approach with `fixest`'s `etable` instead of `modelsummary`.\n\n## The Problem\n\nRecall the dataset: there are two outcomes, `y1` and `y2`, and two treatment variables, `T1` and `T2`:\n\n```{r, echo=T, warning=FALSE, message=FALSE}\ndf_data <- readRDS('001_files/001_data.rds')\n\nhead(df_data)\n\nsummary(df_data)\n\n```\n\nI want to estimate the effect of each treatment on each outcome, running 4 regressions.\n\nAdditionally, I want to report the mean outcome among control units for each case. This is tricky because the estimation sample varies by treatment.\n\nWe'll solve this using the packages *fixest* and *dplyr*.\n\n## Solution\n\nUse `feols` to run the four regressions and store the results.\n\n```{r, warning=FALSE, message=FALSE}\nlibrary(dplyr)\nlibrary(fixest)\n\nmy_estimation <- feols(data = df_data, fml = c(y1,y2) ~ sw(T1, T2))\n```\n\nThe logic behind the approach is to retrieve the model's design matrix and then find the dependent variable values associated with the control observations. Let's first check how it works with a single model.\n\n```{r}\n\n# The object 'my_estimation' is a list; we must retrieve some of the elements to  work with `model.matrix`\nmy_estimation_1 <- my_estimation[lhs = 1, rhs = 1][[1]]\n\n# No, we get the treatment and dependent variables from the design matrix\nt <- model.matrix(my_estimation_1, subset = 'T', type = 'rhs') \ny <- model.matrix(my_estimation_1, type = 'lhs')\n\n# Find which rows contain the control units\ni <- which(t[,1] == 0)\n\n# Compute the mean of the dependent variable for the control units\nprint(mean(y[i]))\n```\n\n**Remark**: I used the argument \"subset\" to define `t`, but not with `y`. This is because the option \"rhs\" produces a matrix with all regressors. By using `subset = \"T\"` I tell the function that I want to keep in `t` only columns whose names match \"T\". In my case, this is sufficient to get only the treatment variable. Be cautious to ensure that you retrieve the correct variable.\n\nNow, I use the `fitstat_register` function from `fixest` to apply these steps to all regressions and display the computed statistic in the regression table.\n\nWe must supply three arguments for this function:\n\n```{r}\n\nfitstat_register(\n  type = \"meandepvar\", \n  fun = function(x) {\n    \n    t <- model.matrix(x, subset = 'T', type = 'rhs') \n    y <- model.matrix(x, type = 'lhs')\n    i <- which(t[,1] == 0)\n    return(mean(y[i]))\n    \n    },\n  alias = \"Mean of Dep. Variable\"\n  )\n\n```\n\nThe argument *type* establishes a name for the statistic, which you will need to refer to when calling it within the table.\n\nThen, we must supply the function that effectively computes the statistic using the objects available from the estimation output.\n\nFinally, the argument *alias* is the text displayed in the regression table.\n\nI now use `etable` to report the regression output, including the desired statistics with the \"fitstat\" argument. I include our custom \"meandepvar\" and the number of observations \"n\".\n\n```{r}\netable(my_estimation,\n       fitstat = ~ meandepvar + n)\n```\n\nThat's it.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":false,"output-file":"002_multiple_estim_custom_stats_II.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.39","theme":["lumen","../custom.scss"],"linkcolor":"#2E2E2E","fontsize":"12pt","mainfont":"system-ui","callout-icon":false,"callout-appearance":"minimal","grid":{"body-width":"900px"},"title":"Multiple estimation with custom statistics II","author":"Vinicius Lima","editor":"visual","project-dir":"C:/Dropbox/academic/website/vinic-lima.github.io/posts"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}